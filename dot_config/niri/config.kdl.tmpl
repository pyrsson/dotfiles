// https://yalter.github.io/niri/Configuration:-Introduction

// include "outputs.kdl"

// https://yalter.github.io/niri/Configuration:-Input
input {
    keyboard {
        xkb {
            // You can set rules, model, layout, variant and options.
            // For more information, see xkeyboard-config(7).

            // For example:
            layout "se"
            options "caps:escape"
            variant "nodeadkeys"

            // If this section is empty, niri will fetch xkb settings
            // from org.freedesktop.locale1. You can control these using
            // localectl set-x11-keymap.
        }
        repeat-delay 250
        repeat-rate 30
        // Enable numlock on startup, omitting this setting disables it.
        numlock
    }

    // Next sections include libinput settings.
    // Omitting settings disables them, or leaves them at their default values.
    // All commented-out settings here are examples, not defaults.
    touchpad {
        // off
        tap
        // dwt
        // dwtp
        // drag false
        // drag-lock
        // natural-scroll
        accel-speed 0.3
        scroll-factor 0.6
        // accel-profile "flat"
        // scroll-method "two-finger"
        // disabled-on-external-mouse
    }

    mouse {
        // off
        // natural-scroll
        accel-speed 0.3
        accel-profile "flat"
        // scroll-method "no-scroll"
    }

    trackpoint {
        // off
        // natural-scroll
        // accel-speed 0.2
        // accel-profile "flat"
        // scroll-method "on-button-down"
        // scroll-button 273
        // scroll-button-lock
        // middle-emulation
    }

    warp-mouse-to-focus

    focus-follows-mouse max-scroll-amount="50%"
}

cursor {
    xcursor-theme "Bibata-Modern-Ice"
    xcursor-size 24
}

debug {
    honor-xdg-activation-with-invalid-serial
}

// https://yalter.github.io/niri/Configuration:-Layout
layout {
    gaps 10

    background-color "transparent"

    center-focused-column "never"

    preset-column-widths {
        proportion 0.5
        proportion 0.66667
    }

    default-column-width { proportion 0.5; }


    // You can change how the focus ring looks.
    focus-ring {
        // off

        width 3

        // active-color "#7aa2f7"

        inactive-color "#1d202f"

        active-gradient from="#7aa2f7" to="#bb9af7" angle=45 relative-to="workspace-view"

        // inactive-gradient from="#505050" to="#808080" angle=45 relative-to="workspace-view"
    }

    shadow {
        // Uncomment the next line to enable shadows.
        // on

        // Softness controls the shadow blur radius.
        softness 30

        // Spread expands the shadow.
        spread 5

        // Offset moves the shadow relative to the window.
        offset x=0 y=5

        // You can also change the shadow color and opacity.
        color "#0007"
    }

    // Struts shrink the area occupied by windows, similarly to layer-shell panels.
    // You can think of them as a kind of outer gaps. They are set in logical pixels.
    // Left and right struts will cause the next window to the side to always be visible.
    // Top and bottom struts will simply add outer gaps in addition to the area occupied by
    // layer-shell panels and regular gaps.
    struts {
        // left 32
        // right 32
        // top 64
        // bottom 64
    }
}

recent-windows {
    // off
    debounce-ms 750

    open-delay-ms 150

    highlight {
        active-color "#7aa2f799"
        urgent-color "#f7768e99"
        padding 30
        corner-radius 8
    }

    previews {
        max-height 480
        max-scale 0.5
    }

    binds {
        Alt+Tab         { next-window; }
        Alt+Shift+Tab   { previous-window; }
        Alt+grave       { next-window     filter="app-id"; }
        Alt+Shift+grave { previous-window filter="app-id"; }

        Mod+Tab         { next-window; }
        Mod+Shift+Tab   { previous-window; }
        Mod+grave       { next-window     filter="app-id"; }
        Mod+Shift+grave { previous-window filter="app-id"; }
    }
}

hotkey-overlay {
    skip-at-startup
}

prefer-no-csd

screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"

workspace "default" {
    {{- if eq .chezmoi.hostname "thinkpad-x1" }}
    open-on-output "eDP-1"
    {{- else if eq .chezmoi.hostname "sidearm" }}
    open-on-output "DP-1"
    {{- end }}
}

{{- if eq .chezmoi.hostname "sidearm" }}
workspace "gaming" {
    open-on-output "DP-1"
}

window-rule {
    match app-id="steam"
    open-on-workspace "gaming"
}
{{- end }}

workspace "chat" {
    {{- if eq .chezmoi.hostname "sidearm" }}
    open-on-output "DP-2"
    {{- else if eq .chezmoi.hostname "thinkpad-x1" }}
    open-on-output "eDP-1"
    {{- end }}
}

// https://yalter.github.io/niri/Configuration:-Window-Rules
window-rule {
    match app-id="zen" title="^Picture-in-Picture$"
    default-floating-position x=8 y=8 relative-to="bottom-right"
    default-column-width { fixed 1280; }
    default-window-height { fixed 720; }
    open-floating true
}

window-rule {
    match app-id="ghostty-floating"
    open-floating true
}

window-rule {
    match app-id=r#"Bitwarden"#
    match app-id="steam" title="Friends List"
    match app-id="nm-openconnect-auth-dialog"
    open-floating true
}

window-rule {
    match app-id="zen" at-startup=true
    match app-id="com.mitchellh.ghostty" at-startup=true
    open-on-workspace "default"
}

window-rule {
    match app-id=r#"Spotify"#
    match app-id="vesktop"
    match app-id="discord"
    match app-id=r#"Slack"#

    open-on-workspace "chat"
    // open-on-output {{ if eq .chezmoi.hostname "sidearm" }}"DP-2"{{ else if eq .chezmoi.hostname "thinkpad-x1" }}"eDP-1"{{ end }}
}

window-rule {
    match app-id=r#"steam_app.*"#
    match app-id=r#".*\.exe$"#
    exclude title=r#"^Battle.net"#
    // variable-refresh-rate true
    open-on-workspace "gaming"
    open-fullscreen true
}

// Example: block out two password managers from screen capture.
// (This example rule is commented out with a "/-" in front.)
/-window-rule {
    match app-id=r#"^org\.keepassxc\.KeePassXC$"#
    match app-id=r#"^org\.gnome\.World\.Secrets$"#

    block-out-from "screen-capture"

    // Use this instead if you want them visible on third-party screenshot tools.
    // block-out-from "screencast"
}

window-rule {
    match is-window-cast-target=true

    focus-ring {
        active-color "#f38ba8"
        inactive-color "#7d0d2d"
    }

    border {
        inactive-color "#7d0d2d"
    }

    shadow {
        color "#7d0d2d70"
    }

    tab-indicator {
        active-color "#f38ba8"
        inactive-color "#7d0d2d"
    }
}

window-rule {
    match app-id=r#"^org\.gnome\."#
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    match app-id="Alacritty"
    match app-id="zen"
    match app-id="com.mitchellh.ghostty"
    match app-id="kitty"
    draw-border-with-background false
}

window-rule {
    geometry-corner-radius 8
    draw-border-with-background false
    clip-to-geometry true
}

layer-rule {
    match namespace="^hyprpaper$"
    match namespace="^wallpaper$"
    place-within-backdrop true
}

include "keybinds.kdl"
include "outputs.kdl"
